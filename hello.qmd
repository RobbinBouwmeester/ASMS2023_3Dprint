---
title: "3D print descriptions"
jupyter: python3
format:
  html:
    code-fold: true
    echo: false
    css: styles.css
---

```{python}
import pandas as pd
import vtk
import os
from IPython.display import display, Markdown

#theme: flatly
#format:
#  html:
#    code-fold: true
#    echo: false
#

def stl_to_png(fname="3D_files/nucleosome.stl",fname_out="figs/nucleosome.png"):
    # Load STL file
    reader = vtk.vtkSTLReader()
    reader.SetFileName(fname)
    reader.Update()

    # Create mapper and actor
    mapper = vtk.vtkPolyDataMapper()
    mapper.SetInputData(reader.GetOutput())
    actor = vtk.vtkActor()
    actor.SetMapper(mapper)

    # Set actor color to red
    actor.GetProperty().SetColor(109/255.0, 0, 15/255.0)

    # Create renderer and window
    renderer = vtk.vtkRenderer()
    renderer.AddActor(actor)
    renderer.SetBackground(95/255.0, 95/255.0, 95/255.0) # set background color to white
    window = vtk.vtkRenderWindow()
    window.AddRenderer(renderer)
    window.SetSize(800, 600)

    # Adjust camera position and focal point
    camera = renderer.GetActiveCamera()
    bounds = actor.GetBounds()
    center = [(bounds[0]+bounds[1])/2, (bounds[2]+bounds[3])/2, (bounds[4]+bounds[5])/2]
    distance = max(bounds[1]-bounds[0], bounds[3]-bounds[2], bounds[5]-bounds[4])*1.25
    camera.SetPosition(center[0], center[1], center[2]+1.5*distance)
    camera.SetFocalPoint(center[0], center[1], center[2])

    # Create window-to-image filter
    w2if = vtk.vtkWindowToImageFilter()
    w2if.SetInput(window)
    w2if.Update()

    # Create PNG writer
    writer = vtk.vtkPNGWriter()
    writer.SetFileName(fname_out)
    writer.SetInputData(w2if.GetOutput())
    writer.Write()

infile = "3DPrintingSpecialExhibit_Data_8850325_1680655903.csv"

df = pd.read_csv(infile)

outfile = open("parsedsubmissions.md","w")

#display(Markdown("# 3D print descriptions\n"))
display(Markdown("""3D printing, or additive manufacturing, is a fabrication method that creates three-dimensional objects by depositing materials layer-by-layer, based on a digital model. Models can be printed in a wide range of materials, including polymers, metals, and ceramics. The process begins with a 3D CAD model, which is then sliced into thin layers. 3D printers follow these slices, building the object from the bottom up. Advantages of 3D printing include rapid prototyping, customizability, and “unorthodox” geometries difficult to obtain by traditional manufacturing methods.\n
This exhibit showcases 3D printed mass spectrometer parts, custom laboratory equipment, and instructive teaching aids. The designs with their description are available on this website. **If using any of these designs in your own work, make sure the material is compatible with the conductivity requirements and environment of the application, including temperature, pressure, and exposure to chemicals or solvents. We hold no responsibility for any harm and/or damage caused by the models on this page.**
\n"""))

unique_categories = set(df["Category"])
#Letter in Display, Poster and Website (GitHub)	
    
#Submitter Name: (First)	
#Submitter Name: (Last)	
#Submitter Email:	
#Submitter Affiliation (university, institute, etc)	Title for 3D Print	Description of material, color, method of printing, finishing and assembly.	Description of utility or application of the 3D print.

df.sort_values("Letter in Display, Poster and Website (GitHub)",inplace=True)
for category in unique_categories:
    sub_df = df[df["Category"] == category]
    
    display(Markdown(f"## Category: {category}\n"))

    for row_idx,row in sub_df.iterrows():
        try:
            title_print = row["Title for 3D Print"].lower().replace(" ","-").rstrip("-")
        except:
            pass
        letter = row["Letter in Display, Poster and Website (GitHub)"]
        display(Markdown(f"[{letter} - {title_print}](main.qmd#{letter})"))
        

    for row_idx,row in sub_df.iterrows():
        first_name = row["Submitter Name: (First)"]
        last_name = row["Submitter Name: (Last)"]
        title_print = row["Title for 3D Print"]
        affilitation = row["Submitter Affiliation (university, institute, etc)"]
        description = row["Description of utility or application of the 3D print."]
        material = row["Description of material, color, method of printing, finishing and assembly."]
        letter = row["Letter in Display, Poster and Website (GitHub)"]
        lic = "CC-BY"
        stl_file = row["stl_file"]

        display(Markdown(f"### {letter} - {title_print}"+"{#"+letter+"}"))
        display(Markdown(f"#### Author information"))
        display(Markdown(f"**Submitted by:** {first_name} {last_name}")) # {row["Submitter Name: (Last)"]}
        display(Markdown(f"**Affiliation:** {affilitation}"))
        display(Markdown(f"#### 3D structure information"))

        display(Markdown(f"**General description:** {description}"))
        display(Markdown(f"**Description of material:** {material}"))
        display(Markdown(f"**License:** {lic}"))

        try:
            fig_dir = os.path.join("figs",stl_file.replace("stl","png"))
            stl_to_png(os.path.join("3D_files",stl_file),fig_dir)
            display(Markdown(f"![]({fig_dir} \"Title\")"))
        except:
            pass
        
        
        display(Markdown(f"***"))

    #    print(row)
```